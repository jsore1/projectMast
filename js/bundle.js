!function(){"use strict";function e(e,t){return new Promise(((n,o)=>{const d=document.createElement("div");d.classList.add("modal__image-card"),t.prepend(d);const l=document.createElement("img");l.onload=()=>n(l),l.classList.add("modal__img"),d.prepend(l),l.setAttribute("src",e)}))}function t(e){document.querySelector(e).classList.add("show")}function n(e){document.querySelector(e).classList.remove("show"),document.querySelector(".modal__image-inner").style.transition="none"}function o(n,o,d){const l=document.querySelector(".modal__text"),a=document.querySelector(".modal__title"),r=document.querySelector(".modal__date"),c=document.querySelector(".modal__image-inner"),s=document.querySelector(".modal__next"),i=document.querySelector(".modal__back"),m=document.querySelector(".loader"),p=[];document.querySelectorAll(".modal__image-card").forEach((e=>{e.remove()})),l.classList.add("hide"),a.textContent=n[o-1].title,r.textContent=d[0].description,c.style.width=100*d.length+"%",m.classList.add("show"),d.length>1?(d.forEach(((t,n)=>{p.push(e(d[n].url,c))})),Promise.all(p).then((()=>{m.classList.remove("show"),t(".modal"),function(e){const t=window.getComputedStyle(document.querySelector(".modal__image-wrapper")).width,n=document.querySelector(".modal__next"),o=document.querySelector(".modal__back"),d=document.querySelector(".modal__image-inner"),l=document.querySelector(".modal__date");n.classList.remove("hide"),o.classList.remove("hide");let a=+t.slice(0,t.length-2)*(e.length-1),r=0;d.style.transform=`translateX(-${a}px)`,n.addEventListener("click",(()=>{d.style.transition="0.5s all",+a.toFixed(1)==+(+t.slice(0,t.length-2)*(e.length-1)).toFixed(1)?(a=0,r=e.length-1):(a+=+t.slice(0,t.length-2),r-=1),d.style.transform=`translateX(-${a}px)`,l.textContent=e[r].description})),o.addEventListener("click",(()=>{d.style.transition="0.5s all",0==a?(a=+t.slice(0,t.length-2)*(e.length-1),r=0):(a-=+t.slice(0,t.length-2),r+=1),d.style.transform=`translateX(-${a}px)`,l.textContent=e[r].description}))}(d)}))):e(d[0].url,c).then((()=>{c.style.transform="none",s.classList.add("hide"),i.classList.add("hide"),m.classList.remove("show"),t(".modal")}))}window.addEventListener("DOMContentLoaded",(()=>{fetch("select_points.php",{method:"POST"}).then((e=>e.json())).then((e=>{!function(e,t){if(e.length>0){const t=document.querySelector(".plan");e.forEach((e=>{t.insertAdjacentHTML("beforeend",`<div class="plan__point" style="top: ${e.y}px;left: ${e.x}px" data-id="${e.id}">\n                    ${e.name}\n                </div>`)}))}}(e),function(e,t,n){let d=!1,l=!1;const a=document.getElementById("add-point"),r=document.getElementById("update-point");a.addEventListener("change",(()=>{d=a.checked})),r.addEventListener("change",(()=>{l=r.checked}));const c=document.querySelector(".plan");c.addEventListener("click",(t=>{const a=+t.target.getAttribute("data-id");if(l&&t.target&&t.target.className===n){let e=new Date;if(t.preventDefault(),confirm("Обновить точку?")){const t=prompt("Введите дату фото",`Дата съемки: ${e.getDate()}.${+e.getMonth()+1}.${e.getFullYear()}`),n=prompt("Введите путь к фото",`images/photo_${e.getDate()}_${+e.getMonth()+1}_${e.getFullYear()}/`);if(null===t||null===n)return;let o=new FormData;o.append("id",a),o.append("description",t),o.append("url",n),fetch("update_point.php",{method:"POST",body:o}).then((e=>e.text())).then((e=>{"1"===e&&console.log("Точка обновлена!")}))}}else if(d&&t.target&&"IMG"===t.target.tagName){if(confirm("Добавить новую точку на план?")){let e=new Date;const n=t.offsetY-10,o=t.offsetX-10,d=prompt("Введите имя для точки","имя точки"),l=prompt("Введите название для фото","название фото"),a=prompt("Введите дату фото",`Дата съемки: ${e.getDate()}.${+e.getMonth()+1}.${e.getFullYear()}`),r=prompt("Введите путь к фото",`images/photo_${e.getDate()}_${+e.getMonth()+1}_${e.getFullYear()}/`);if(null===d||null===l||null===a||null===r)return;let s=new FormData;s.append("x",o),s.append("y",n),s.append("name",d),s.append("title",l),s.append("date",a),s.append("url",r),fetch("add_point.php",{method:"POST",body:s}).then((e=>e.text())).then((e=>{"1"===e&&(console.log("Точка добавлена!"),c.insertAdjacentHTML("beforeend",`<div class="plan__point" style="top: ${n}px;left: ${o}px" data-id="">\n                                    <span>${d}</span>\n                                </div>`))}))}}else if(t.target&&t.target.className===n){let t=new FormData;t.append("id",a),fetch("select_images_archive.php",{method:"POST",body:t}).then((e=>e.json())).then((t=>{t.reverse(),t.push({url:e[a-1].url,description:e[a-1].date}),o(e,a,t.reverse())}))}}))}(e,0,"plan__point")})),fetch("get_table.php",{method:"POST"}).then((e=>e.json())).then((e=>{const t=document.querySelector(".main-table").children[0].children[1];e.reverse().forEach(((e,n)=>{const o=`<tr>\n                            <td>${e.date}</td>\n                            <td>${e.numberObject}</td>\n                            <td>${e.description}</td>\n                            <td>${e.secondName}</td>\n                        </tr>`;t.insertAdjacentHTML("beforeend",o)}))})),function(){const e=document.querySelector(".modal");document.querySelector(".modal__close").addEventListener("click",(()=>n(".modal"))),e.addEventListener("click",(t=>{t.target===e&&n(".modal")}))}()}))}();
//# sourceMappingURL=bundle.js.map